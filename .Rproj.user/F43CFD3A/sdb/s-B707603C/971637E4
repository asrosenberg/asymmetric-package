{
    "collab_server" : "",
    "contents" : "library(asymmetric)\noptions(stringsAsFactors = FALSE)\ncolors <- brewer.pal(7, \"Set1\")\nload(\"inst/extdata/Coxappend.RData\")\n\n# Make Figure 6 and Figure 7\nCGG.test <- sfa(x$enps ~ x$eneth * x$lnml | x$eneth * x$lnml, ineffDecrease=TRUE)\nyhat <- CGG.test$mleParam[1] + x$eneth*CGG.test$mleParam[2] +\n  x$lnml*CGG.test$mleParam[3] + x$eneth*x$lnml*CGG.test$mleParam[4]\nxgrid <- seq(min(x$eneth), max(x$eneth), length=10)\nwgrid <- seq(min(x$lnml), max(x$lnml), length=10)\nfrontier.pred <- function(x, w){\n  CGG.test$mleParam[1] + x*CGG.test$mleParam[2] + w*CGG.test$mleParam[3] +\n  x*w*CGG.test$mleParam[4]\n}\nygrid <- outer(xgrid, wgrid, frontier.pred)\npar(mfrow=c(1,2))\npar(mar=c(2,2,2,2))\nfor(r in c(240,300)){\n  p <- persp(xgrid, wgrid, ygrid, col = \"#FFFFFF22\", border = \"#00000022\",\n  phi = 10, theta = r, xlab = \"Electoral system permissiveness\",\n  ylab = \"Social heterogeneity\", zlab = \"Party system size\", cex.lab = 0.7)\n  obs <- trans3d(x$eneth, x$lnml, x$enps, p)\n  pred <- trans3d(x$eneth, x$lnml, yhat, p)\n  points(obs, col = \"black\", pch = 19, cex = 0.2)\n  segments(obs$x, obs$y, pred$x, pred$y, col = \"#00000022\")\n}\n\nCGG.test.reduced <- sfa(x$enps ~ x$eneth * x$lnml, ineffDecrease=TRUE)\nlrtest <- -2*CGG.test.reduced$mleLogl + 2*CGG.test$mleLogl\npchisq(lrtest, df=4, lower.tail=FALSE)\n\nresid <- x$enps - yhat\nsimpleCap <- function(x) {\n  s <- strsplit(x, \" \")[[1]]\n  paste(toupper(substring(s, 1,1)), substring(s, 2),\n    sep=\"\", collapse=\" \")\n}\n\nx$var12[45] <- \"St. Kitts and Nevis\"\nx$var12[46] <- \"St. Lucia\"\nx$var12[47] <- \"St. Vincent & Grenadines\"\nx$var12[51] <- \"United Kingdom\"\nx$var12[52] <- \"United States\"\n\n##############\n# Figure 7\n##############\n\ndotchart(sort(resid), labels=sapply(tolower(x$var12[order(resid)]), simpleCap),\n  cex=0.4, pch=19, lcolor=\"gray90\", main=\"Party System Size 'Inefficiency'\")\nabline(v=0)\n\n#############\n# Do AOC Test\n#############\nCGG.test <- sfa(x$enps ~ x$eneth * x$lnml | x$eneth * x$lnml, ineffDecrease=TRUE)\nyhat <- CGG.test$mleParam[1] + x$eneth*CGG.test$mleParam[2] +\n  x$lnml*CGG.test$mleParam[3] + x$eneth*x$lnml*CGG.test$mleParam[4]\n\ncgg_function <- function(x, y)\n{\n  CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + y * CGG.test$mleParam[3] +\n    x * y * CGG.test$mleParam[4]\n}\n\nplane_function <- function(x, y)\n{\n  CGG.test$mleParam[1]\n}\n\nAOC_SFA_3D <- function(x, y, fun)\n{\n  integral <- integral2(fun = cgg_function, xmin = min(x), xmax = max(x),\n    ymin = min(y), ymax = max(y))\n  AUC_lower <- integral2(fun = plane_function, xmin = min(x),\n    xmax = max(x), ymin = min(y), ymax = max(y))\n  AUC_dif <- integral$Q - AUC_lower$Q\n  AUC <- (AUC_dif)/((max(x) - min(x)) * (max(y) -\n    min(y)) * (max(cgg_function(x, y)) - min(cgg_function(x, y))))\n  1 - AUC\n}\n\n#################\n# AOC for Table 6\n#################\nAOC_SFA_3D(x = x$eneth, y = x$lnml, fun = cgg_function)\n\nboot_CGG <- function(dat)\n{\n  idx <- sample(1:nrow(dat), nrow(dat), replace=TRUE)\n  sample.dta <- dat[idx,]\n  x <- sample.dta$eneth\n  y <- sample.dta$lnml\n  CGG.test <- sfa(sample.dta$enps ~ x * y | x * y, ineffDecrease=TRUE)\n  cgg_function <- function(x, y)\n  {\n    CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + y * CGG.test$mleParam[3] +\n      x * y * CGG.test$mleParam[4]\n  }\n  plane_function <- function(x, y)\n  {\n    CGG.test$mleParam[1]\n  }\n  integral <- integral2(fun = cgg_function, xmin = min(x), xmax = max(x),\n    ymin = min(y), ymax = max(y))\n  AUC_lower <- integral2(fun = plane_function, xmin = min(x),\n    xmax = max(x), ymin = min(y), ymax = max(y))\n  AUC_dif <- integral$Q - AUC_lower$Q\n  AUC <- (AUC_dif)/((max(x) - min(x)) * (max(y) -\n    min(y)) * (max(cgg_function(x, y)) - min(cgg_function(x, y))))\n  1 - AUC\n}\ndat <- x\nrm(x)\nCGG_reps <- replicate(10000, boot_CGG(dat = dat))\nquantile(CGG_reps, c(0.025, 0.975))\n\n\n# generate CI with for loop\nnboots <- 5000\nboots <- c()\nfor(i in 1:nboots){\nidx <- sample(1:nrow(dat), nrow(dat), replace=TRUE)\nsample.dta <- dat[idx,]\nx <- sample.dta$eneth\ny <- sample.dta$lnml\nCGG.test <- sfa(sample.dta$enps ~ x * y | x * y, ineffDecrease=TRUE)\ncgg_function <- function(x, y)\n{\n  CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + y * CGG.test$mleParam[3] +\n    x * y * CGG.test$mleParam[4]\n}\nplane_function <- function(x, y)\n{\n  CGG.test$mleParam[1]\n}\nintegral <- integral2(fun = cgg_function, xmin = min(x), xmax = max(x),\n  ymin = min(y), ymax = max(y))\nAUC_lower <- integral2(fun = plane_function, xmin = min(x),\n  xmax = max(x), ymin = min(y), ymax = max(y))\nAUC_dif <- integral$Q - AUC_lower$Q\nAUC <- (AUC_dif)/((max(x) - min(x)) * (max(y) -\n  min(y)) * (max(cgg_function(x, y)) - min(cgg_function(x, y))))\nboots[i] <- 1 - AUC\n}\n\n#################\n# CIs for Table 6\n#################\nquantile(boots, c(0.025, 0.5, 0.975))\n",
    "created" : 1483916437846.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2251024961",
    "id" : "971637E4",
    "lastKnownWriteTime" : 1483916687,
    "last_content_update" : 1483916687660,
    "path" : "~/asymmetric-package/replication/figure6_7:table6.R",
    "project_path" : "replication/figure6_7:table6.R",
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}