{
    "collab_server" : "",
    "contents" : "library(pracma)\nlibrary(zoo)\nlibrary(frontier)\nlibrary(data.table)\nlibrary(foreign)\nlibrary(quantreg)\nlibrary(npbr)\nlibrary(ggplot2)\nlibrary(countrycode)\nlibrary(RColorBrewer)\nlibrary(Rglpk)\nlibrary(plot3D)\noptions(stringsAsFactors = FALSE)\nsource(\"~/Dropbox/Archive/unifying-study-asymmetric/functions.R\")\ncolors <- brewer.pal(7, \"Set1\")\nload(\"inst/extdata/Coxappend.RData\")\nCGG.test <- sfa(x$enps ~ x$eneth * x$lnml | x$eneth * x$lnml, ineffDecrease=TRUE)\nyhat <- CGG.test$mleParam[1] + x$eneth*CGG.test$mleParam[2] +\n  x$lnml*CGG.test$mleParam[3] + x$eneth*x$lnml*CGG.test$mleParam[4]\n\ncgg_function <- function(x, w)\n{\n  CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + w * CGG.test$mleParam[3] +\n    x * w * CGG.test$mleParam[4]\n}\n\nplane_function <- function(x, y)\n{\n  CGG.test$mleParam[1]\n}\n\nintegral2(fun = cgg_function, xmin = min(x$eneth), xmax = max(x$eneth),\n  ymin = min(x$lnml), ymax = max(x$lnml))\nintegral2(fun = plane_function, xmin = min(x$eneth), xmax = max(x$eneth),\n          ymin = min(x$lnml), ymax = max(x$lnml))\n\nAOC_SFA_3D <- function(x, y, fun)\n{\n  integral <- integral2(fun = cgg_function, xmin = min(x), xmax = max(x),\n    ymin = min(y), ymax = max(y))\n  AUC_lower <- integral2(fun = plane_function, xmin = min(x),\n    xmax = max(x), ymin = min(y), ymax = max(y))\n  AUC_dif <- integral$Q - AUC_lower$Q\n  AUC <- (AUC_dif)/((max(x) - min(x)) * (max(y) -\n    min(y)) * (max(cgg_function(x, y)) - min(cgg_function(x, y))))\n  1 - AUC\n}\nAOC_SFA_3D(x = x$eneth, y = x$lnml, fun = cgg_function)\ncgg_function <- function(x, y)\n{\n  CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + y * CGG.test$mleParam[3] +\n    x * y * CGG.test$mleParam[4]\n}\nboot_CGG <- function(dat)\n{\n  idx <- sample(1:nrow(dat), nrow(dat), replace=TRUE)\n  sample.dta <- dat[idx,]\n  x <- sample.dta$eneth\n  y <- sample.dta$lnml\n  # CGG.test <- sfa(enps ~ eneth * lnml | eneth * lnml, ineffDecrease=TRUE,\n  #   data = sample.dta)\n  CGG.test <- sfa(sample.dta$enps ~ x * y | x * y, ineffDecrease=TRUE)\n  cgg_function <- function(x, y)\n  {\n    CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + y * CGG.test$mleParam[3] +\n      x * y * CGG.test$mleParam[4]\n  }\n  plane_function <- function(x, y)\n  {\n    CGG.test$mleParam[1]\n  }\n  integral <- integral2(fun = cgg_function, xmin = min(x), xmax = max(x),\n    ymin = min(y), ymax = max(y))\n  AUC_lower <- integral2(fun = plane_function, xmin = min(x),\n    xmax = max(x), ymin = min(y), ymax = max(y))\n  AUC_dif <- integral$Q - AUC_lower$Q\n  AUC <- (AUC_dif)/((max(x) - min(x)) * (max(y) -\n    min(y)) * (max(cgg_function(x, y)) - min(cgg_function(x, y))))\n  1 - AUC\n}\ndat <- x\nrm(x)\nCGG_reps <- replicate(10, boot_CGG(dat = dat))\nquantile(CGG_reps, c(0.025, 0.975))\n\n\n# try a for loop\nnboots <- 1000\nboots <- c()\nfor(i in 1:nboots){\nidx <- sample(1:nrow(dat), nrow(dat), replace=TRUE)\nsample.dta <- dat[idx,]\nx <- sample.dta$eneth\ny <- sample.dta$lnml\n# CGG.test <- sfa(enps ~ eneth * lnml | eneth * lnml, ineffDecrease=TRUE,\n#   data = sample.dta)\nCGG.test <- sfa(sample.dta$enps ~ x * y | x * y, ineffDecrease=TRUE)\ncgg_function <- function(x, y)\n{\n  CGG.test$mleParam[1] + x * CGG.test$mleParam[2] + y * CGG.test$mleParam[3] +\n    x * y * CGG.test$mleParam[4]\n}\nplane_function <- function(x, y)\n{\n  CGG.test$mleParam[1]\n}\nintegral <- integral2(fun = cgg_function, xmin = min(x), xmax = max(x),\n  ymin = min(y), ymax = max(y))\nAUC_lower <- integral2(fun = plane_function, xmin = min(x),\n  xmax = max(x), ymin = min(y), ymax = max(y))\nAUC_dif <- integral$Q - AUC_lower$Q\nAUC <- (AUC_dif)/((max(x) - min(x)) * (max(y) -\n  min(y)) * (max(cgg_function(x, y)) - min(cgg_function(x, y))))\nboots[i] <- 1 - AUC\n}\nquantile(boots, c(0.025, 0.5, 0.975))\n\n\n# WTF what if I just use rnorm data\n# x <- rnorm(200)\n# y <- rnorm(200)\n# qtest <- rq(y ~ x, tau = 0.95)\n# y_qr <- qtest$coefficients[1] + qtest$coefficients[2] * x\n# AUC_qr <- sum(diff(sort(x)) * rollmean(sort(y_qr), 2))\n# AUC_lower <- sum(diff(sort(x)) * min(sort(y)))\n# AUC_difference <- AUC_qr - AUC_lower\n# total_area <- (max(x) - min(x)) * (max(y) - min(y))\n# AUC_percent <- AUC_difference/total_area\n# result <- 1 - AUC_percent\n# plot(x, y)\n\n",
    "created" : 1483796876212.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2171924854",
    "id" : "FE86A107",
    "lastKnownWriteTime" : 1483808629,
    "last_content_update" : 1483808629754,
    "path" : "~/Dropbox/Archive/unifying-study-asymmetric/CGG_AOC.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 7,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}